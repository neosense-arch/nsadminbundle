<!DOCTYPE html>
<html lang="en">
<head>
    <title>Admin panel</title>

	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    {% stylesheets filter='cssrewrite'
        '@MopaBootstrapBundle/Resources/bootstrap/docs/assets/css/bootstrap.css'
        '@MopaBootstrapBundle/Resources/bootstrap/docs/assets/css/bootstrap-responsive.css'
        '@NSAdminBundle/Resources/public/css/style.css'
        '@NSAdminBundle/Resources/public/select2-3.4.5/select2.css'
    %}
        <link href="{{ asset_url }}" type="text/css" rel="stylesheet" media="screen"/>
    {% endstylesheets %}

	{% block styles %}
		<link href="{{ asset('bundles/nsadmin/dynatree-bootstrap-skin/ui.dynatree.css') }}" type="text/css" rel="stylesheet" media="screen"/>
		<link href="{{ asset('bundles/nsadmin/jquery-file-upload/css/bootstrap-image-gallery.min.css') }}" rel="stylesheet" />
		<link href="{{ asset('bundles/nsadmin/jquery-file-upload/css/jquery.fileupload-ui.css') }}" rel="stylesheet">
		<noscript><link href="{{ asset('bundles/nsadmin/jquery-file-upload/css/jquery.fileupload-ui-noscript.css') }}" rel="stylesheet"></noscript>
	{% endblock %}

	{# HEAD JS block #}
	{% block javascripts %}
		{# IE compatibility #}
		<!--[if lt IE 9]><script src="{{ asset('bundles/nsadmin/html5shim/html5.js') }}"></script><![endif]-->

		{# jQuery #}
		<script src="{{ asset('bundles/nsadmin/jquery/jquery.min.js') }}"></script>
		<script src="{{ asset('bundles/nsadmin/jquery/jquery-ui.min.js') }}"></script>
	{% endblock %}
</head>

<body data-spy="scroll" data-target=".bs-docs-sidebar">

<div class="navbar navbar-inverse navbar-fixed-top" id="ns-navbar" style="background: red">
    <div class="navbar-inner">
        <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

			<style type="text/css">
				.brand img {
					opacity: 0.6;
				}
				.brand:hover img {
					opacity: 0.9;
				}
 			</style>

            <a class="brand" href="{{ path('ns_admin_index') }}"><img src="{{ asset('bundles/nsadmin/images/home.png') }}"></a>

            <div class="nav-collapse collapse">
				{% if is_granted("ROLE_ADMIN") %}
					{{ knp_menu_render('main', { currentClass: 'active', ancestorClass: 'active' }) }}
				{% endif %}
            </div>

			<div class="nav-collapse collapse pull-right">
				<div class="loader" id="ns-loader">&nbsp;</div>
			</div>
        </div>
    </div>
</div>

<div class="container" style="margin-top: 30px">
    {% block content %}
		&nbsp;
    {% endblock %}
</div>

<footer class="footer">
    <hr/>
    <div class="container">
        <p class="pull-right ns-sincerely">
			<a href="http://neosense.ru" target="_blank">Sincerely</a>
        </p>
		{% if is_granted("IS_AUTHENTICATED_REMEMBERED") %}
			{{ app.user.username }} |
			<a href="{{ url('fos_user_security_logout') }}">выйти</a>
		{% else %}
			<a href="{{ path('fos_user_security_login') }}">{{ 'layout.login'|trans({}, 'FOSUserBundle') }}</a>
		{% endif %}
		({{ ns_core_version() }})
    </div>
</footer>

<script type="text/javascript">
	$(function($){
		// LOADER
		$('#ns-loader').css('opacity', 0);

		// SORTABLES
		$(".table-sortable tbody").each(function(i, tbody){
			// ajax-handler check
			if (!$(tbody).parent().attr('data-sortable-handler')) {
				throw "Required attribute 'data-sortable-handler' wasn't found";
			}

			$(tbody).sortable({
				'helper': function(e, ui) {
					ui.children().each(function() {
						$(this).width($(this).width());
					});
					return ui;
				},
				'axis': 'y',
				'stop': function(e, ui){
					// checking id attribute
					if (!ui.item.attr('data-sortable-id')) {
						throw "Required attribute 'data-sortable-id' wasn't found";
					}
					// saving position
					$('#ns-loader').animate({'opacity': 1});
					$.ajax({
						'url': $(tbody).parent().attr('data-sortable-handler'),
						'data': {
							'id': +ui.item.attr('data-sortable-id'),
							'position': $(tbody).find('tr').index(ui.item)
						}
					})
					.done(function(res){
						if (res && typeof(res.error) != 'undefined') {
							throw res.error;
						}
					})
					.always(function(){
						$('#ns-loader').animate({'opacity': 0});
					});
				}
			}).disableSelection();
		});

		// CONFIRM BUTTONS
		$('.ns-confirm').click(function(){
			if (confirm('Вы уверены?')) {
				location.href = $(this).attr('href');
			}
			return false;
		});
	});
</script>

{% block foot_script %}
	{# Dynatree #}
	<script src="{{ asset('bundles/nsadmin/dynatree/jquery/jquery.cookie.js') }}"></script>
	<script src="{{ asset('bundles/nsadmin/dynatree/dist/jquery.dynatree.min.js') }}"></script>

	{# jQuery Values #}
	<script src="{{ asset('bundles/nsadmin/jquery/jquery.values.min.js') }}"></script>

    {# To only use a subset or add more js overwrite and copy paste this block
    To speed up page loads save a copy of jQuery in your project and override this block to include the correct path
    Otherwise the regeneration is done on every load in dev more with use_controller: true
     #}
    {% javascripts
        '@MopaBootstrapBundle/Resources/bootstrap/js/bootstrap-transition.js'
        '@MopaBootstrapBundle/Resources/bootstrap/js/bootstrap-modal.js'
        '@MopaBootstrapBundle/Resources/bootstrap/js/bootstrap-dropdown.js'
        '@MopaBootstrapBundle/Resources/bootstrap/js/bootstrap-scrollspy.js'
        '@MopaBootstrapBundle/Resources/bootstrap/js/bootstrap-tab.js'
        '@MopaBootstrapBundle/Resources/bootstrap/js/bootstrap-tooltip.js'
        '@MopaBootstrapBundle/Resources/bootstrap/js/bootstrap-popover.js'
        '@MopaBootstrapBundle/Resources/bootstrap/js/bootstrap-alert.js'
        '@MopaBootstrapBundle/Resources/bootstrap/js/bootstrap-button.js'
        '@MopaBootstrapBundle/Resources/bootstrap/js/bootstrap-collapse.js'
        '@MopaBootstrapBundle/Resources/bootstrap/js/bootstrap-carousel.js'
        '@MopaBootstrapBundle/Resources/bootstrap/js/bootstrap-typeahead.js'
        '@MopaBootstrapBundle/Resources/public/js/mopabootstrap-collection.js'
        '@MopaBootstrapBundle/Resources/public/js/mopabootstrap-subnav.js'
        '@NSAdminBundle/Resources/public/select2-3.4.5/select2.js'
    %}
        <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}

	{{ tinymce_init() }}

	<!-- The Load Image plugin is included for the preview images and image resizing functionality -->
	<script src="{{ asset('bundles/nsadmin/load-image/load-image.min.js') }}"></script>

	<!-- The Canvas to Blob plugin is included for image resizing functionality -->
	<script src="{{ asset('bundles/nsadmin/load-image/canvas-to-blob.min.js') }}"></script>

	<!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
	<script src="{{ asset('bundles/nsadmin/jquery-file-upload/js/jquery.iframe-transport.js') }}"></script>

	<!-- The basic File Upload plugin -->
	<script src="{{ asset('bundles/nsadmin/jquery-file-upload/js/jquery.fileupload.js') }}"></script>

	<!-- The File Upload file processing plugin -->
	<script src="{{ asset('bundles/nsadmin/jquery-file-upload/js/jquery.fileupload-fp.js') }}"></script>

	<script src="{{ asset('bundles/nsadmin/load-image/jquery.getimagedata.min.js') }}"></script>
{% endblock foot_script %}

</body>
</html>
